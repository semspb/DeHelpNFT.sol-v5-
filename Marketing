1. Количество уровней и проценты выплат

LEVEL_COUNT = 7 — в реферальной схеме 7 уровней начислений.

levelPercentsBP = [5000, 700, 700, 700, 700, 700, 700] — распределение наград по уровням в базисных пунктах (1% = 100 BP):

1 уровень → 50% (5000 / 10000)

2–7 уровни → 7% (700 / 10000) каждый

Итого при полной сети: 50% + 6×7% = 92% (остальное идёт в пул/казну).

2. Проценты пула и резерва

PARTNER_POOL_PERCENT = 700 → 7% от baseAmount идёт в партнёрский пул (для активных партнёров, с распределением через accRewardPerShare).

RESERVE_PERCENT = 100 → 1% уходит в резерв/казну.

3. NFT и активность пользователей

PARTNER_MIN_MINTS = 10 → после 10 минтов пользователь становится партнёром и получает «долю пула» (poolShares).

MAX_LEVELS_TO_CLIMB = 10 → поиск активного спонсора вверх по дереву не более 10 уровней.

MAX_COOWNERS = 10 → максимум со-владельцев проекта.

MAX_COOWNER_PERCENT = 50 → максимум процента совместного владения (для всех coOwners суммарно).

activityDuration — стандартная длительность активности при минте.

maxActivityDuration — максимальная длительность активности (для защиты от бесконечного накопления).

4. Финансовые параметры

baseAmount — основная сумма, которая идёт на реферальные выплаты и пул.

ownerFee — дополнительный «сервисный» сбор, который распределяется между казной и coOwners.

В функции mint:

totalPrice = baseAmount + ownerFee → это та сумма, которую пользователь платит за NFT.

treasuryAmount — сумма, которая идёт в казну (из нераспределённых реферальных выплат + reserve + часть ownerFee).

5. Параметры пула партнёров

accRewardPerShare — накопленная награда на один «poolShare» (используется для точного распределения между партнёрами).

totalPartnerShares — суммарное количество долей в пуле.

partnerShareDebt[address] — долг по начисленным, но ещё не выплаченным наградам конкретного партнёра.

6. NFT и предыдущие владельцы

nftPreviousOwner[tokenId] — хранит предыдущего владельца NFT для перераспределения долей пула при трансфере NFT.

poolShares — количество долей NFT, которые учитываются в партнёрском пуле.

7. Админские ограничения

MAX_COOWNERS = 10 — ограничение на количество со-владельцев.

MAX_COOWNER_PERCENT = 50 — ограничение на сумму процентов со-владельцев.

coOwnerPercent[coOwner] — процент конкретного со-владельца.

coOwnerPendingRewards[coOwner] — ещё не выведенные награды со-владельца.

8. Точные расчёты

Расчёт уровня:

levelReward = (baseAmount * levelPercentsBP[level]) / 10000


Расчёт доли партнёра:

poolRewardPerShare = (poolReward * PRECISION_SCALE) / totalPartnerShares
userReward = (user.poolShares * accRewardPerShare) / PRECISION_SCALE - partnerShareDebt[user]


Расчёт доли coOwner:

coOwnerShare = (ownerFee * coOwnerPercent[coOwner]) / 100
treasuryAmount = ownerFee - sum(coOwnerShare)

9. PRECISION_SCALE

PRECISION_SCALE = 1e18 — используется для точных дробных вычислений наград на доли пула, чтобы избежать потери при делении на маленькие числа.

10. Итоги по выплатам

Из baseAmount:

~50% → спонсор 1 уровня

7% × 6 уровней → спонсоры уровней 2–7

7% → партнёрский пул

1% → резерв/казна

OwnerFee:

распределяется между coOwners (по проценту) и казной
